# 设计模式

## 常见设计模式

1. 工厂模式

   比如 render 或者 createElement 函数会根据不同参数返回是标签 VNode 还是组件的 VNode

2. 单例模式

   比如在 VueRouter 或者 Vuex 中的插件注册方法 install 判断如果系统存在实例就直接返回掉

3. 发布订阅

   类似于 DOM 事件机制，Vue 的事件机制

   发布发布订阅模型实现方式可以参考：[/#手写发布订阅模型](手写代码)

## 手写发布订阅模型

```js
class Event {
  constructor() {
    this.events = {};
  }

  // 添加订阅
  on(type, callback) {
    if (!this.events[type]) {
      this.events[type] = [callback];
    } else {
      this.events[type].push(callback);
    }
  }

  // 解绑事件
  off(type, callback) {
    if (!this.events[type]) return;
    this.events[type] = this.events[type].filter(t => {
      return t !== callback;
    });
  }

  // 只执行一次的订阅事件
  once(type, callback) {
    function fn() {
      callback();
      this.off(type, fn);
    }

    this.on(type, fn);
  }

  // 触发事件
  emit(type, ...args) {
    this.events[type] &&
      this.events[type].forEach(callback => callback.apply(this, args));
  }
}
```
